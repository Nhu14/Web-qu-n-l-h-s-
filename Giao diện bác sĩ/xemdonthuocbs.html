<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Xem ƒë∆°n thu·ªëc</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="xemdonthuocbs.css">
</head>
<body>
    <div class="sidebar">
      <h1>H·ªí S∆† Y T·∫æ</h1>
      <div class="search">
        <input type="text" placeholder="T√¨m ki·∫øm">
      </div>
      <a href="tongquanbs.html" class="nav-item">üìÑ T·ªïng quan</a>
        <a href="hosobenhnhanbs.html" class="nav-item">üë§ H·ªì s∆° b·ªánh nh√¢n</a>
        <a href="lichkhambs.html" class="nav-item">üìÖ L·ªãch kh√°m</a>
        <a href="donthuocbs.html" class="nav-item">üìò ƒê∆°n thu·ªëc</a>
        <a href="tracuubs.html" class="nav-item">üîç Tra c·ª©u</a>
        <a href="caidacbs.html" class="nav-item">‚öôÔ∏è C√†i ƒë·∫∑t</a>
    </div>
  
    <div class="main-container">
      <div class="topbar">
        <div class="left">
          <span>‚ò∞</span>
          <button class="update-btn">Update Now !</button>
        </div>
        <div class="avatar">
          <span>üîî</span>
          <span>Ng·ªçc Anh</span>
        </div>
      </div>
  
      <div class="content">
        <h2>ƒê∆°n thu·ªëc</h2>
  
        <div class="info">
          <div><strong>T√™n b·ªánh nh√¢n:</strong> Nh·∫≠t H·∫°</div>
          <div><strong>ID:</strong> Ocb1234</div>
          <div><strong>Chu·∫©n ƒëo√°n:</strong> TƒÉng huy·∫øt √°p</div>
        </div>
  
        <div class="prescription-table p-3">
          <button class="btn btn-primary btn-sm mb-3" id="openModalBtn">Th√™m ƒë∆°n thu·ªëc</button>
          <table class="table table-bordered table-hover" id="prescriptionTable">
              <thead class="table-light">
                  <tr>
                      <th>M√£ thu·ªëc</th>
                      <th>T√™n thu·ªëc</th>
                      <th>Lo·∫°i thu·ªëc</th>
                      <th>S·ªë l∆∞·ª£ng</th>
                      <th>Gi√°</th>
                      <th>Ghi ch√∫</th>
                      <th></th>
                  </tr>
              </thead>
              <tbody>
              </tbody>
          </table>
      </div>
  </div>
</div>
</div>

<div id="prescriptionModal" class="modal">
<div class="modal-content">
  <span class="close-button">&times;</span>
  <h4>Th√™m/S·ª≠a ƒë∆°n thu·ªëc</h4>
  <form id="prescriptionForm">
      <input type="hidden" id="prescriptionId">
      <div class="mb-3">
          <label for="tenThuoc" class="form-label">T√™n thu·ªëc</label>
          <input type="text" class="form-control" id="tenThuoc" required>
      </div>
       <div class="mb-3">
          <label for="loaiThuoc" class="form-label">Lo·∫°i thu·ªëc</label>
          <select class="form-select" id="loaiThuoc" required>
              <option value="">Ch·ªçn lo·∫°i thu·ªëc</option>
              <option value="Vi√™n">Vi√™n</option>
              <option value="N∆∞·ªõc">N∆∞·ªõc</option>
              <option value="B·ªôt">B·ªôt</option>
          </select>
      </div>
      <div class="mb-3">
          <label for="soLuong" class="form-label">S·ªë l∆∞·ª£ng</label>
          <input type="number" class="form-control" id="soLuong" required min="0">
      </div>
      <div class="mb-3">
          <label for="gia" class="form-label">Gi√°</label>
          <input type="number" class="form-control" id="gia" required min="0">
      </div>
      <div class="mb-3">
          <label for="ghiChu" class="form-label">Ghi ch√∫</label>
          <textarea class="form-control" id="ghiChu" rows="3"></textarea>
      </div>
      <button type="submit" class="btn btn-primary">L∆∞u ƒë∆°n thu·ªëc</button>
  </form>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const modal = document.getElementById("prescriptionModal");
const openModalBtn = document.getElementById("openModalBtn");
const closeModalBtn = document.querySelector(".close-button");
const prescriptionForm = document.getElementById("prescriptionForm");
const prescriptionTableBody = document.querySelector("#prescriptionTable tbody");
const prescriptionIdInput = document.getElementById("prescriptionId");
// const maThuocInput = document.getElementById("maThuoc"); // Kh√¥ng c·∫ßn d√≤ng n√†y n·ªØa

// Function to generate a unique ID (random string)
function generateId() {
  return Math.random().toString(36).substring(2, 15);
}

// Function to save/update prescription to local storage
function savePrescription(prescription) {
  let prescriptions = localStorage.getItem('prescriptions');
  prescriptions = prescriptions ? JSON.parse(prescriptions) : [];
  const existingIndex = prescriptions.findIndex(p => p.id === prescription.id);
  if (existingIndex > -1) {
      prescriptions[existingIndex] = prescription; // Update existing
  } else {
      prescriptions.push(prescription); // Add new
  }
  localStorage.setItem('prescriptions', JSON.stringify(prescriptions));
}

// Function to get all prescriptions from local storage
function getPrescriptions() {
  const prescriptions = localStorage.getItem('prescriptions');
  return prescriptions ? JSON.parse(prescriptions) : [];
}

// Function to display prescriptions on the table
function displayPrescriptions() {
  prescriptionTableBody.innerHTML = ''; // Clear existing rows
  const prescriptions = getPrescriptions();
  prescriptions.forEach(prescription => {
      const row = prescriptionTableBody.insertRow();
      row.insertCell().textContent = prescription.maThuoc; // Display the generated ID
      row.insertCell().textContent = prescription.tenThuoc;
      row.insertCell().textContent = prescription.loaiThuoc;
      row.insertCell().textContent = prescription.soLuong;
      row.insertCell().textContent = prescription.gia;
      row.insertCell().textContent = prescription.ghiChu || '';

      const actionsCell = row.insertCell();
      actionsCell.classList.add('text-center');

      const editButton = document.createElement('button');
      editButton.classList.add('btn', 'btn-sm', 'btn-outline-primary', 'me-2');
      editButton.textContent = 'S·ª≠a';
      editButton.addEventListener('click', () => editPrescription(prescription.id));
      actionsCell.appendChild(editButton);

      const deleteButton = document.createElement('button');
      deleteButton.classList.add('btn', 'btn-sm', 'btn-outline-danger', 'me-2');
      deleteButton.textContent = 'X√≥a';
      deleteButton.addEventListener('click', () => deletePrescription(prescription.id));
      actionsCell.appendChild(deleteButton);

      const viewButton = document.createElement('button');
      viewButton.classList.add('btn', 'btn-sm', 'btn-outline-info');
      viewButton.textContent = 'Xem chi ti·∫øt';
      viewButton.addEventListener('click', () => viewPrescriptionDetails(prescription));
      actionsCell.appendChild(viewButton);
  });
}

// Function to populate the modal form for editing
function editPrescription(id) {
  const prescription = getPrescriptions().find(p => p.id === id);
  if (prescription) {
      prescriptionIdInput.value = prescription.id;
      const maThuocValue = prescription.maThuoc; // L·∫•y gi√° tr·ªã M√£ thu·ªëc ƒë·ªÉ hi·ªÉn th·ªã (kh√¥ng cho s·ª≠a)
      // Kh√¥ng c·∫ßn set gi√° tr·ªã cho maThuocInput n·ªØa v√¨ n√≥ ƒë√£ b·ªã x√≥a
      document.getElementById('tenThuoc').value = prescription.tenThuoc;
      document.getElementById('loaiThuoc').value = prescription.loaiThuoc;
      document.getElementById('soLuong').value = prescription.soLuong;
      document.getElementById('gia').value = prescription.gia;
      document.getElementById('ghiChu').value = prescription.ghiChu || '';
      modal.style.display = "block";
  }
}

// Function to delete a prescription
function deletePrescription(id) {
  if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n thu·ªëc n√†y?')) {
      let prescriptions = getPrescriptions().filter(p => p.id !== id);
      localStorage.setItem('prescriptions', JSON.stringify(prescriptions));
      displayPrescriptions();
  }
}

// Function to view prescription details
function viewPrescriptionDetails(prescription) {
  alert(`Chi ti·∫øt ƒë∆°n thu·ªëc:\nM√£ thu·ªëc: ${prescription.maThuoc}\nT√™n thu·ªëc: ${prescription.tenThuoc}\nLo·∫°i thu·ªëc: ${prescription.loaiThuoc}\nS·ªë l∆∞·ª£ng: ${prescription.soLuong}\nGi√°: ${prescription.gia}\nGhi ch√∫: ${prescription.ghiChu || 'Kh√¥ng c√≥'}`);
}

// Event listeners for modal
openModalBtn.onclick = function() {
  modal.querySelector('h4').textContent = 'Th√™m ƒë∆°n thu·ªëc';
  prescriptionForm.reset();
  prescriptionIdInput.value = ''; // Clear ID for adding new
  modal.style.display = "block";
}

closeModalBtn.onclick = function() {
  modal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == modal) {
      modal.style.display = "none";
  }
}

// Event listener for form submission (add or edit)
prescriptionForm.addEventListener('submit', function(event) {
  event.preventDefault(); // Prevent default form submission

  const id = prescriptionIdInput.value || generateId();
  const maThuoc = id; // S·ª≠ d·ª•ng ID ƒë√£ t·∫°o l√†m M√£ thu·ªëc
  const tenThuoc = document.getElementById('tenThuoc').value;
  const loaiThuoc = document.getElementById('loaiThuoc').value;
  const soLuong = parseInt(document.getElementById('soLuong').value);
  const gia = parseInt(document.getElementById('gia').value);
  const ghiChu = document.getElementById('ghiChu').value;

  if (isNaN(soLuong) || isNaN(gia)) {
      alert('Vui l√≤ng nh·∫≠p s·ªë h·ª£p l·ªá cho S·ªë l∆∞·ª£ng v√† Gi√°.');
      return;
  }

  const newPrescription = {
      id: id,
      maThuoc: maThuoc,
      tenThuoc: tenThuoc,
      loaiThuoc: loaiThuoc,
      soLuong: soLuong,
      gia: gia,
      ghiChu: ghiChu
  };

  savePrescription(newPrescription);
  displayPrescriptions(); // Update the table on the current page
  modal.style.display = "none"; // Close the modal
  prescriptionForm.reset(); // Reset the form
});

// Load and display prescriptions on page load
displayPrescriptions();
</script>
</body>
</html>